<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GeoNetwork JS API testing page</title>
  <link href="/geonetwork/static/gn_search_default.css" rel="stylesheet" media="screen">
</head>
<body ng-app="gn_search_default" data-ng-controller="GnCatController">
  <div data-ng-include="'../../catalog/views/default/templates/index.html'" class="gn-full"></div>
  <script src="/geonetwork/static/lib.js"></script>
  <script src="/geonetwork/catalog/lib/ol3cesium/Cesium/Cesium.js"></script>
  <script src="/geonetwork/static/lib3d.js"></script>
  <script src="/geonetwork/static/gn_search_default.js"></script>
  <script type="text/javascript">
    // Parse config from config URL parameter
    var tokens = /config=([^&]+)/.exec(window.location.search),
        config = tokens ? tokens[1] : undefined,
        defaultConfig = {"mods": {
          "search": {
            "enabled": true,
            "hitsperpageValues": [10,50,500,5000,50000],
            "paginationInfo": {
              "hitsPerPage": 50
            },
            "facetsSummaryType": "details",
            "sortByValues": [{
              "sortBy": "relevance",
              "sortOrder": ""
            }, {
              "sortBy": "changeDate",
              "sortOrder": ""
            }, {
              "sortBy": "title",
              "sortOrder": "reverse"
            }, {
              "sortBy": "rating",
              "sortOrder": ""
            }, {
              "sortBy": "popularity",
              "sortOrder": ""
            }, {
              "sortBy": "denominatorDesc",
              "sortOrder": ""
            }, {
              "sortBy": "denominatorAsc",
              "sortOrder": "reverse"
            }],
            "sortbyDefault": "relevance",
            "resultViewTpls": [{
              "tplUrl": "../../catalog/components/search/resultsview/partials/viewtemplates/grid.html",
              "tooltip": "Grid",
              "icon": "fa-th"
            }]
          },
          "map": {
            "enabled": false,
            "is3DModeAllowed": true,
            "viewerMap": "../../map/config-viewer.xml",
            "listOfServices": {"wms": [], "wmts": []},
            "useOSM": true,
            "context": "",
            "layer": {"url": "http://www2.demis.nl/mapserver/wms.asp?", "layers": "Countries", "version": "1.1.1"},
            "projection": "EPSG:3857",
              "projectionList": [{"code": "EPSG:4326", "label": "WGS84 (EPSG:4326)"}, {
              "code": "EPSG:3857",
              "label": "Google mercator (EPSG:3857)"
            }]
          }}};

    if (config) {
        try {
          config = angular.toJson(config);
        } catch(e) {
          console.log('Invalid configuration: ' + config + '. Using default.');
          console.log(e);
          config = defaultConfig;
        }
    } else {
      config = defaultConfig;
    }
    // TODO: Add a configuration validation process ?
    console.log(config);

    var module = angular.module('gn_search');
    module.config(['gnViewerSettings', 'gnSearchSettings', 'gnGlobalSettings',
      function (gnViewerSettings, gnSearchSettings, gnGlobalSettings) {
        gnViewerSettings.mapConfig = config.mods.map;
        gnSearchSettings = config.mods.search;

        gnGlobalSettings.isMapViewerEnabled = config.mods.map.enabled;

        gnGlobalSettings.gnUrl = 'http://localhost:8080/geonetwork/srv/eng/';
        gnViewerSettings.bingKey = 'AnElW2Zqi4fI-9cYx1LHiQfokQ9GrNzcjOh_p_0hkO1yo78ba8zTLARcLBIf8H6D';
      }]);
  </script>
</body>
</html>
